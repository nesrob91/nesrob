/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. */package com.elektra.dhl;import com.elektra.beans.CredencialesTrackingDhl;import com.elektra.beans.DatosTracking;import com.elektra.beans.TrackingResponse;import com.elektra.dao.TrackingDao;import com.elektra.dao.TrackingDaoImpl;import java.util.ArrayList;import java.util.List;import com.elektra.util.GetNodes;/** * * * * @author dparra * */public class TrackingDhl {    TrackingDao trackingDao = new TrackingDaoImpl();    public TrackingResponse getTracking(DatosTracking datosTracking, CredencialesTrackingDhl credencialesTrackingDhl, String proxy) {        TrackingResponse trackingResponse = new TrackingResponse();        DHLClient dHLClient = new DHLClient();        GetNodes getnodes = new GetNodes();        String mensaje = "";        String request = "";        try {            List<String> response = new ArrayList<>();            List<String> nodos = new ArrayList<>();            nodos.add("ActionStatus");            nodos.add("ConditionData");            nodos.add("EventCode");            nodos.add("Signatory");            nodos.add("Date");            nodos.add("Time");            request = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n"                    + "<req:KnownTrackingRequest xmlns:req=\"http://www.dhl.com\" \n"                    + "						xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n"                    + "						xsi:schemaLocation=\"http://www.dhl.com\n"                    + "						TrackingRequestKnown.xsd\">\n"                    + "	<Request>\n"                    + "		<ServiceHeader>\n"                    + "            <MessageTime>2016-10-19T10:32:52.210-06:00</MessageTime>\n"                    + "            <MessageReference>1329394911120161019103252210</MessageReference>\n"                    + "            <SiteID>" + credencialesTrackingDhl.getUsuario() + "</SiteID>\n"                    + "            <Password>" + credencialesTrackingDhl.getContrasenia() + "</Password>\n"                    + "        </ServiceHeader>\n"                    + "	</Request>\n"                    + "	<LanguageCode>String</LanguageCode>\n"                    + "	<AWBNumber>" + datosTracking.getNumGuia() + "</AWBNumber>\n"                    + "	<LevelOfDetails>" + credencialesTrackingDhl.getLevelOfDetails() + "</LevelOfDetails>\n"                    + "</req:KnownTrackingRequest>";            mensaje = dHLClient.ejecutar(request, credencialesTrackingDhl.getUrl(), proxy);            getnodes.setstring(mensaje);            response = getnodes.getNodes(nodos);            if (response != null && response.size() == 6) {                if (response.get(0).equals("No Shipments Found")) {                    // DO NOTHING                    trackingResponse.setIdEstatusGuia(0);                    trackingResponse.setIdEstatusGuiaCarrier(response.get(0));                    trackingResponse.setRefField1("DO NOTHING");                } else if (response.get(0).equals("success")) {                    trackingResponse.setIdEstatusGuia(trackingDao.getIdEstatusGuia(datosTracking.getIdCarrier(), response.get(2)));                    trackingResponse.setIdEstatusGuiaCarrier(response.get(2));                    if (trackingResponse.getIdEstatusGuia() == 30) {                        trackingResponse.setRecibe(response.get(3).toUpperCase());                        trackingResponse.setFechaRecepcion(response.get(4).substring(8, 10) + "/" + response.get(4).substring(5, 7) + "/" + response.get(4).substring(0, 4) + " " + response.get(5));                    }                    if (trackingResponse.getIdEstatusGuia() == 20) {                        trackingResponse.setFechaRecoleccion(response.get(4).substring(8, 10) + "/" + response.get(4).substring(5, 7) + "/" + response.get(4).substring(0, 4) + " " + response.get(5));                    }                    if (!trackingResponse.getIdEstatusGuiaCarrier().equals("OK") && !trackingResponse.getIdEstatusGuiaCarrier().equals("RT") && !trackingResponse.getIdEstatusGuiaCarrier().equals("PU") && !trackingResponse.getIdEstatusGuiaCarrier().equals("SD")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("PL")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("WC")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("OH")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("AR")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("BA")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("CS")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("NH")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("MD")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("AF")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("FD")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("DF")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("CC")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("CA")                            && !trackingResponse.getIdEstatusGuiaCarrier().equals("CM") //camcio de direccion                            ) {                        System.out.print(trackingResponse.getIdEstatusGuiaCarrier());                    }                } else {                    trackingResponse.setIdEstatusGuia(-1);                    trackingResponse.setRefField1(response.get(1));                    //trackingDao.insXml("-1", response.get(1), credencialesTrackingDhl.getUrl(), request, mensaje, datosTracking, "Tracking");                }            } else {                trackingResponse.setIdEstatusGuia(-1);                //trackingDao.insXml("-1", "Respuesta mal formada", "Respuesta mal formada", request, mensaje, datosTracking, "Tracking");                trackingResponse.setRefField1("Respuesta mal formada");            }        } catch (Exception e) {            trackingResponse.setIdEstatusGuia(-1);            trackingResponse.setIdEstatusGuiaCarrier(null);            trackingResponse.setRefField1(e.toString());        }        return trackingResponse;    }}